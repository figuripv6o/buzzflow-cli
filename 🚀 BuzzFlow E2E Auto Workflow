#!/bin/bash
# ==========================================
# üêù BuzzFlow One-Shot Auto Workflow
# Deploys Backend (Firebase), Frontend (WebFlow),
# WordPress Hive theme, and Expo Mobile apps.
# ==========================================

set -e

# 1Ô∏è‚É£ Setup
cd ~/Buzzanator_FDF
PROJECT=buzzcoreex
REPO=https://github.com/figuripv6o/buzzflow-cli.git

echo "üöÄ BuzzFlow Auto Workflow ‚Äî starting..."

# 2Ô∏è‚É£ Pull latest repo
rm -rf buzzflow-cli
git clone $REPO
cd buzzflow-cli

# 3Ô∏è‚É£ Backend (Firebase Functions)
cd backend
npm install
firebase use $PROJECT
firebase deploy --only functions
echo "‚úÖ Backend deployed to Firebase Functions"

# 4Ô∏è‚É£ Frontend (Firebase Hosting)
cd ../webflow
firebase use $PROJECT
firebase deploy --only hosting
echo "‚úÖ Frontend deployed to Firebase Hosting"

# 5Ô∏è‚É£ WordPress (WebPress Buzzomatic Hive)
cd ..
zip -r buzzflow-webpress.zip webflow
echo "‚ö° Upload buzzflow-webpress.zip into WordPress (Themes/Plugins)"

# 6Ô∏è‚É£ Mobile App (Expo + EAS)
cd mobile || mkdir mobile && cd mobile
npx create-expo-app buzzflow-mobile --yes
cd buzzflow-mobile
npm install firebase expo-router react-native-webview
eas build -p android --profile preview --non-interactive
eas build -p ios --profile preview --non-interactive
echo "üì± Mobile app builds queued on EAS"

# 7Ô∏è‚É£ GitHub Push (auto-archive)
cd ~/Buzzanator_FDF/buzzflow-cli
git init
git branch -M main
git remote add origin $REPO
git add .
git commit -m 'üöÄ BuzzFlow E2E Auto Deploy ‚Äî FDF Certified'
git push -u origin main -f

echo "üî• One-Shot Deploy Complete: Web + Backend + App + Hive"
